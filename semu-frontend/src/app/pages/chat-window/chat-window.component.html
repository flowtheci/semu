<svg *ngIf="isMobile" [@flyChatBox]="chatBoxAnimState" class="logo-small" width="304" height="255" viewBox="0 0 304 255" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M247.195 181.417C247.195 169.644 247.042 158.014 247.276 146.391C247.362 142.151 245.29 139.761 242.008 137.979C236.319 134.89 230.072 133.424 223.827 131.962C218.418 130.695 212.916 129.964 207.441 129.082C204.35 128.584 201.217 128.349 198.097 127.996C197.891 126.394 199.378 126.183 200.141 125.467C201.03 124.634 202.049 123.971 202.719 122.889C203.283 121.98 204.5 121.744 205.075 120.748C205.863 119.384 206.996 118.289 208.165 117.237C208.669 116.784 208.866 115.753 209.097 115.594C210.383 114.701 210.052 112.853 211.552 112.024C212.288 111.618 212.743 110.344 213.307 109.463C214.518 107.57 215.242 105.4 216.313 103.399C217.352 101.457 218.228 99.2495 218.896 97.0029C219.65 94.4666 220.22 91.8267 221.163 89.3235C221.43 88.615 221.413 87.7998 221.52 87.0755C220.138 86.3086 219.081 87.3643 217.904 87.5038C214.987 87.8495 212.187 88.7799 209.426 89.7233C207.405 90.414 205.484 91.5083 203.556 92.3762C202.037 93.06 200.353 93.6804 198.925 94.5481C197.109 95.6522 195.26 96.7498 193.496 97.9669C192.431 98.702 191.181 99.5403 190.577 100.404C189.175 102.407 186.607 102.814 185.325 104.842C185.023 105.32 184.865 105.875 184.646 106.336C183.751 108.225 181.591 108.669 180.509 110.352C179.576 111.802 178.805 113.305 178.256 114.898C177.992 115.664 177.342 116.002 177.018 116.664C175.607 119.545 174.112 122.385 172.678 125.255C172.5 125.61 172.483 126.024 171.951 126.024C168.995 126.02 166.039 126.022 162.929 126.022C163.303 124.369 163.588 122.937 164.177 121.584C165.067 119.54 165.679 117.401 166.393 115.297C167.077 113.284 167.881 111.279 168.723 109.318C170.678 104.762 171.692 100.164 171.003 95.1453C170.598 92.1957 169.867 89.4008 168.968 86.591C168.519 85.188 167.523 83.8814 167.85 82.2651C167.859 82.2248 167.83 82.1537 167.796 82.1314C165.558 80.6642 166.309 77.6774 164.584 75.8619C163.844 75.083 162.479 74.3091 162.966 72.7598C161.499 72.3301 161.913 70.3255 160.344 69.7591C159.682 69.5203 159.2 68.2185 158.702 67.3694C157.483 65.2883 155.475 64.0261 153.75 62.49C152.582 61.4497 151.589 62.8465 150.888 63.4034C149.186 64.7563 147.697 66.4178 146.51 68.2655C145.715 69.5032 144.571 70.5191 144.203 72.0519C143.95 73.1106 142.918 73.7264 142.379 74.7069C141.68 75.9786 141.178 77.4307 140.335 78.5195C139.359 79.7786 138.883 81.2348 138.478 82.5594C137.502 85.7463 136.14 88.8174 135.724 92.2093C135.334 95.393 135.165 98.5572 135.173 101.749C135.175 102.558 135.158 103.378 135.828 103.933C136.471 104.465 135.954 105.149 136.191 105.729C136.781 107.171 137.395 108.608 137.871 110.088C138.396 111.72 139.397 113.162 139.649 114.908C139.805 115.99 140.872 116.692 140.946 117.913C141.068 119.92 142.709 121.502 142.706 123.582C142.706 123.726 142.754 123.872 142.797 124.012C143.412 126.03 143.412 125.995 141.178 126.044C139.056 126.09 136.935 125.9 134.81 126.18C133.685 126.327 133.208 125.341 132.925 124.481C132.262 122.464 131.393 120.574 130.063 118.907C129.606 118.334 129.514 117.581 129.232 116.93C128.376 114.959 127.704 112.89 126.101 111.377C124.039 109.431 122.931 106.733 120.816 104.843C119.802 103.936 118.91 102.834 117.52 102.485C116.94 102.339 116.603 101.606 116.544 101.473C116.042 100.337 114.316 100.409 114.195 98.9371C113.546 98.8404 112.654 99.0364 112.616 97.9283C112.612 97.7985 112.34 97.57 112.193 97.57C110.796 97.5696 110.256 95.9113 109.211 95.7917C107.81 95.6313 107.153 94.5211 106.203 93.9338C104.778 93.053 102.856 93.128 101.806 91.6076C101.518 91.1907 101.056 91.667 100.7 91.4951C98.6923 90.5254 96.4567 90.0294 94.4932 89.1674C91.8407 88.0029 88.9463 88.2307 86.3949 86.9542C85.2294 86.3711 84.3079 87.4034 84.7698 88.791C85.3721 90.6003 85.6643 92.4644 86.1005 94.3026C86.4542 95.7928 87.4829 97.1537 87.6778 98.6419C87.8704 100.113 89.0988 101.198 88.9004 102.727C88.8826 102.864 88.9079 103.095 88.9932 103.144C90.7956 104.191 90.4607 106.451 91.6877 107.862C92.3247 108.595 92.6576 109.646 92.9578 110.606C93.4493 112.178 94.6904 113.336 95.6457 114.453C96.329 115.251 96.6109 116.471 97.3818 116.882C99.1624 117.83 99.2834 120.093 101.148 121.035C101.822 121.376 102.872 122.199 103.302 123.331C103.52 123.904 103.992 124.898 105.283 124.622C105.706 124.532 106.843 125.744 106.993 126.268C107.277 127.262 107.951 127.144 108.583 127.325C108.303 128.06 107.753 128.051 107.22 128.121C97.0757 129.45 86.923 130.724 77.0201 133.442C72.6847 134.632 68.4327 136.029 64.5149 138.262C63.332 138.936 62.031 139.597 61.2636 141.077C62.5677 141.396 63.7029 141.286 64.8107 141.241C69.5064 141.049 73.9577 141.944 78.0354 144.298C83.4666 147.433 86.4985 152.106 86.7943 158.459C86.8466 159.583 86.3862 159.908 85.3195 159.892C82.0547 159.844 78.7884 159.849 75.5234 159.889C74.5403 159.902 74.1898 159.608 74.0772 158.566C73.6151 154.29 70.5941 151.588 66.3203 151.242C63.7248 151.031 61.2854 151.247 58.9038 152.403C55.4905 154.061 53.5692 159.438 58.2715 162.631C60.9668 164.461 63.9791 165.503 67.0293 166.493C71.5413 167.956 75.9851 169.527 79.8856 172.372C84.3313 175.615 86.7327 179.823 86.8128 185.391C86.8685 189.257 86.22 192.788 83.6401 195.875C80.9442 199.1 77.4489 200.946 73.4975 201.786C65.5943 203.467 57.8122 203.229 50.5005 199.257C44.6861 196.098 41.5771 191.135 40.8686 184.599C40.7271 183.294 41.114 182.742 42.5518 182.79C45.616 182.892 48.6895 182.907 51.7521 182.783C53.1876 182.724 53.7342 183.319 53.8124 184.581C53.9688 187.106 55.161 189.052 57.0625 190.642C58.4472 191.8 60.1502 192.247 61.8265 192.509C64.0413 192.854 66.3006 192.941 68.5381 192.355C71.7571 191.513 73.7479 189.626 74.0949 186.944C74.4668 184.069 73.0277 181.565 70.0847 179.988C67.5105 178.607 64.7564 177.679 61.996 176.762C57.6358 175.312 53.3614 173.676 49.6168 170.915C45.1761 167.641 42.4444 163.318 42.7268 157.748C42.9603 153.142 43.8839 148.582 46.5384 144.573C47.4297 143.227 48.0159 141.681 48.7592 140.236C49.9778 137.865 52.0582 136.197 53.7465 134.213C55.2752 132.417 57.0437 130.827 58.6321 129.079C59.314 128.328 60.2538 128.05 61.0247 127.461C63.3026 125.721 65.9877 124.623 68.5969 123.566C70.7267 122.702 72.8927 121.674 75.2738 121.454C75.788 121.407 76.3724 121.414 76.9414 120.908C75.6051 120.793 76.4191 119.727 76.0136 119.097C73.0344 114.463 71.1382 109.403 69.8183 104.04C69.0124 100.766 68.7031 97.5113 68.421 94.1869C67.9592 88.7455 68.6545 83.3878 68.9956 77.995C69.0809 76.6454 69.528 75.4165 69.6875 74.1107C69.7793 73.3587 70.2822 73.0612 71.0144 72.9732C73.3567 72.6916 75.7449 72.5767 78.0232 72.02C83.6264 70.6508 89.302 71.193 94.9343 71.2787C98.8133 71.3377 102.65 72.29 106.375 73.5217C107.54 73.9069 108.767 74.1221 109.979 74.3324C110.229 74.3757 110.415 74.2922 110.505 74.6016C110.746 75.4306 111.538 75.5139 112.166 75.6347C113.907 75.9695 115.226 77.0817 116.701 77.906C117.889 78.5697 119.087 79.2018 120.472 79.5873C121.165 77.2486 121.757 75.0479 122.481 72.8912C122.837 71.8306 123.62 70.9696 124.052 69.896C124.74 68.1888 125.635 66.5612 126.255 64.8161C126.394 64.4252 126.665 64.1699 127.049 63.986C127.809 63.621 128.197 63.193 128.398 62.1736C128.539 61.4554 129.012 59.9544 130.383 59.8144C130.687 59.7833 130.862 59.6626 130.95 59.4619C131.69 57.7728 133.658 57.1703 134.486 55.7288C135.594 53.8012 137.556 53.0219 138.99 51.5772C139.336 51.2282 139.698 50.9526 139.886 50.4664C140.082 49.959 140.348 49.468 141.084 49.6534C141.293 49.7061 141.694 49.6268 141.769 49.4835C142.463 48.1584 144.428 48.2624 144.878 46.7114C145.085 45.9968 145.632 46.5916 146.06 46.3581C148.073 45.26 149.912 43.8351 152.114 43.0628C152.956 42.7675 153.524 42.6436 154.403 43.1691C155.454 43.7976 156.469 44.5582 157.755 44.8599C159.013 45.1549 159.993 46.2198 160.93 47.0113C162.531 48.3644 164.336 49.4465 166.037 50.5633C167.364 51.4352 168.425 52.3805 169.465 53.5107C170.112 54.2134 171.355 54.0326 171.971 55.0633C172.293 55.6035 173.063 55.873 172.891 56.7156C172.875 56.7933 172.962 56.9689 173.006 56.9707C174.342 57.0263 174.135 58.5848 174.928 59.0058C176.472 59.8265 177.041 61.3501 178.057 62.558C179.78 64.6082 180.237 67.2543 181.801 69.3405C182.408 70.15 182.581 71.2954 183.409 71.968C184.063 72.4983 183.492 73.154 183.772 73.753C184.536 75.3907 185.108 77.1042 185.415 78.9097C185.543 79.6669 186.028 80.0915 186.919 79.4755C187.807 78.8621 188.709 78.2604 189.651 77.7099C191.986 76.3443 194.433 74.949 196.901 74.2012C199.681 73.359 202.6 72.6589 205.483 72.0114C211.166 70.7349 216.863 71.3105 222.55 71.2449C226.32 71.2015 229.966 72.4761 233.719 72.8027C234.158 72.841 234.595 72.974 235.032 72.967C236.097 72.9501 236.635 73.6074 236.669 74.4993C236.772 77.2077 237.168 79.8887 237.361 82.5886C237.634 86.3924 237.561 90.1881 237.595 93.9878C237.621 96.9524 237.344 99.9353 236.607 102.767C236.049 104.91 235.564 107.11 234.68 109.21C234.045 110.72 233.068 112.27 232.886 113.774C232.622 115.954 230.715 116.839 230.09 118.6C229.959 118.968 229.703 119.289 229.523 119.64C228.977 120.7 229.356 121.42 230.465 121.575C233.91 122.059 237.019 123.494 240.121 124.925C242.848 126.184 245.459 127.699 247.717 129.685C248.586 130.449 249.637 130.79 250.548 131.424C251.167 131.854 251.341 132.483 251.797 132.957C252.308 133.487 252.611 134.15 253.504 134.165C254.069 134.174 254.188 134.731 254.436 135.153C255.11 136.304 255.461 137.806 257.282 137.871C257.101 139.584 258.479 140.376 259.306 141.462C259.84 142.162 260.185 142.787 260.182 143.703C260.153 155.825 260.238 167.948 260.122 180.069C260.077 184.751 259.59 189.416 256.904 193.526C253.617 198.557 248.824 201.355 243.065 202.232C237.083 203.143 231.029 203.181 225.359 200.51C219.393 197.699 215.655 193.069 214.547 186.487C214.014 183.322 213.928 180.121 213.936 176.912C213.961 165.978 213.945 155.043 213.948 144.109C213.949 142.152 213.958 142.147 215.902 142.144C219.504 142.14 223.106 142.143 226.626 142.143C227.063 142.843 226.906 143.452 226.907 144.028C226.917 156.942 226.936 169.856 226.907 182.769C226.895 188.18 230.302 191.935 235.678 192.352C239.166 192.623 242.388 192.171 244.841 189.442C246.837 187.222 247.241 184.438 247.195 181.417Z" fill="#FFFFFF"/>
  <path d="M141.521 143.191C141.513 142.304 141.984 142.153 142.598 142.153C147.446 142.156 152.293 142.159 157.14 142.15C157.843 142.148 158.184 142.471 158.412 143.129C159.138 145.223 159.949 147.286 160.686 149.375C163.337 156.896 165.963 164.426 168.616 171.946C169.926 175.66 171.276 179.359 172.603 183.067C172.687 183.303 172.77 183.525 173.147 183.676C173.959 182.292 174.379 180.729 174.907 179.229C179.047 167.473 183.154 155.704 187.246 143.931C187.68 142.683 188.269 142.058 189.767 142.101C194.116 142.225 198.472 142.173 202.824 142.125C203.96 142.113 204.373 142.45 204.371 143.64C204.34 162.486 204.343 181.331 204.366 200.177C204.368 201.276 204.113 201.782 202.884 201.755C199.621 201.684 196.355 201.697 193.091 201.751C191.969 201.77 191.654 201.332 191.662 200.268C191.7 195.174 191.53 190.073 191.722 184.986C191.901 180.259 192.026 175.523 192.366 170.811C192.565 168.063 192.229 165.284 192.837 162.557C192.971 161.956 192.95 161.277 192.603 160.518C191.541 162.214 191.094 164.063 190.459 165.804C186.33 177.133 182.267 188.486 178.23 199.848C177.738 201.234 177.107 201.935 175.495 201.775C173.682 201.595 171.835 201.668 170.01 201.755C168.921 201.807 168.375 201.348 168.036 200.398C166.039 194.788 164.032 189.182 162.018 183.579C159.506 176.589 156.988 169.601 154.458 162.617C154.282 162.132 153.992 161.689 153.641 161.003C153.068 162.321 153.144 163.451 153.337 164.448C153.867 167.187 153.63 169.958 153.802 172.703C154.379 181.926 154.181 191.173 154.195 200.413C154.197 201.488 153.745 201.757 152.771 201.745C149.754 201.709 146.737 201.735 143.719 201.732C141.512 201.731 141.508 201.728 141.508 199.574C141.507 181.866 141.508 164.158 141.509 146.45C141.509 145.412 141.513 144.373 141.521 143.191Z" fill="#FFFFFF"/>
  <path d="M94.601 164.813C94.6017 157.737 94.6348 150.81 94.5754 143.884C94.5637 142.515 94.9957 142.118 96.3462 142.122C108.617 142.165 120.887 142.165 133.158 142.118C134.53 142.112 134.964 142.538 134.905 143.89C134.809 146.113 134.826 148.344 134.905 150.568C134.949 151.797 134.522 152.184 133.296 152.177C125.33 152.134 117.364 152.155 109.398 152.157C107.28 152.158 107.278 152.162 107.277 154.294C107.275 157.757 107.314 161.221 107.255 164.684C107.236 165.865 107.665 166.219 108.813 166.212C115.492 166.173 122.173 166.238 128.851 166.16C130.37 166.143 130.841 166.605 130.757 168.095C130.64 170.167 130.668 172.252 130.746 174.327C130.793 175.576 130.314 175.93 129.111 175.922C122.531 175.879 115.95 175.902 109.369 175.905C107.282 175.906 107.278 175.908 107.277 177.922C107.274 182.029 107.338 186.137 107.243 190.242C107.209 191.719 107.724 192.058 109.113 192.048C117.078 191.99 125.045 192.059 133.01 191.986C134.53 191.972 134.994 192.422 134.91 193.915C134.792 196.036 134.84 198.17 134.9 200.295C134.932 201.387 134.544 201.753 133.446 201.751C121.027 201.722 108.608 201.713 96.1892 201.761C94.7912 201.767 94.5792 201.189 94.5825 199.991C94.6144 188.314 94.6013 176.638 94.601 164.813Z" fill="#FFFFFF"/>
  <path d="M154.496 99.0245C154.862 101.917 155.85 104.551 156.336 107.315C156.979 110.974 157.713 114.62 157.905 118.322C158.013 120.388 158.848 122.33 158.66 124.431C158.577 125.351 158.341 125.763 157.363 125.748C154.693 125.707 152.021 125.713 149.35 125.746C148.419 125.758 148.055 125.438 148.021 124.465C147.893 120.853 148.132 117.227 148.764 113.719C149.249 111.03 149.419 108.265 150.17 105.646C151.165 102.177 151.271 98.4995 152.935 95.0137C154.013 96.0744 153.954 97.6275 154.496 99.0245Z" fill="#FFFFFF"/>
  <path d="M97.5673 98.1901C98.3951 97.8317 98.8713 98.361 99.425 98.6364C99.3675 99.3278 99.2798 100.003 99.2617 100.679C99.2229 102.129 98.2981 102.79 97.0606 103.052C95.6741 103.345 94.7232 102.34 94.2735 101.366C93.8232 100.391 94.096 99.143 95.0524 98.288C95.8282 97.5946 96.6519 98.1974 97.5673 98.1901Z" fill="#FFFFFF"/>
  <path d="M211.953 95.9463C213.716 97.232 213.029 98.8006 212.751 100.339C211.956 100.399 211.24 100.449 210.524 100.507C209.052 100.627 208.127 99.7386 208.006 98.0834C207.916 96.8419 208.834 95.8977 210.227 95.8421C210.766 95.8206 211.309 95.8763 211.953 95.9463Z" fill="#FFFFFF"/>
  <path d="M150.865 76.4373C150.785 75.9321 150.681 75.5331 150.726 75.1512C150.815 74.3838 150.016 73.3341 151.39 72.9449C152.777 72.5523 154.134 72.4513 154.999 73.8591C155.586 74.8137 155.04 76.3637 154.011 77.0254C152.853 77.7698 151.794 77.6818 150.865 76.4373Z" fill="#FFFFFF"/>
</svg>
<div class="chat-container" [class.open]="isOpen" [class.safe-area]="isIOS()">
  <div class="chat-title">Matemaatika
    <p *ngIf="hasConversationId" class="subtitle">{{conversationTitle}}</p>
  </div>
  <div #messageBox id="messageBox" class="chat-messages" [scrollTop]="scrollTop">
    <svg [@flyUpAndAway]="animState" *ngIf="this.messages.length === 0" class="background-image" width="304" height="255" viewBox="0 0 304 255" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M247.195 181.417C247.195 169.644 247.042 158.014 247.276 146.391C247.362 142.151 245.29 139.761 242.008 137.979C236.319 134.89 230.072 133.424 223.827 131.962C218.418 130.695 212.916 129.964 207.441 129.082C204.35 128.584 201.217 128.349 198.097 127.996C197.891 126.394 199.378 126.183 200.141 125.467C201.03 124.634 202.049 123.971 202.719 122.889C203.283 121.98 204.5 121.744 205.075 120.748C205.863 119.384 206.996 118.289 208.165 117.237C208.669 116.784 208.866 115.753 209.097 115.594C210.383 114.701 210.052 112.853 211.552 112.024C212.288 111.618 212.743 110.344 213.307 109.463C214.518 107.57 215.242 105.4 216.313 103.399C217.352 101.457 218.228 99.2495 218.896 97.0029C219.65 94.4666 220.22 91.8267 221.163 89.3235C221.43 88.615 221.413 87.7998 221.52 87.0755C220.138 86.3086 219.081 87.3643 217.904 87.5038C214.987 87.8495 212.187 88.7799 209.426 89.7233C207.405 90.414 205.484 91.5083 203.556 92.3762C202.037 93.06 200.353 93.6804 198.925 94.5481C197.109 95.6522 195.26 96.7498 193.496 97.9669C192.431 98.702 191.181 99.5403 190.577 100.404C189.175 102.407 186.607 102.814 185.325 104.842C185.023 105.32 184.865 105.875 184.646 106.336C183.751 108.225 181.591 108.669 180.509 110.352C179.576 111.802 178.805 113.305 178.256 114.898C177.992 115.664 177.342 116.002 177.018 116.664C175.607 119.545 174.112 122.385 172.678 125.255C172.5 125.61 172.483 126.024 171.951 126.024C168.995 126.02 166.039 126.022 162.929 126.022C163.303 124.369 163.588 122.937 164.177 121.584C165.067 119.54 165.679 117.401 166.393 115.297C167.077 113.284 167.881 111.279 168.723 109.318C170.678 104.762 171.692 100.164 171.003 95.1453C170.598 92.1957 169.867 89.4008 168.968 86.591C168.519 85.188 167.523 83.8814 167.85 82.2651C167.859 82.2248 167.83 82.1537 167.796 82.1314C165.558 80.6642 166.309 77.6774 164.584 75.8619C163.844 75.083 162.479 74.3091 162.966 72.7598C161.499 72.3301 161.913 70.3255 160.344 69.7591C159.682 69.5203 159.2 68.2185 158.702 67.3694C157.483 65.2883 155.475 64.0261 153.75 62.49C152.582 61.4497 151.589 62.8465 150.888 63.4034C149.186 64.7563 147.697 66.4178 146.51 68.2655C145.715 69.5032 144.571 70.5191 144.203 72.0519C143.95 73.1106 142.918 73.7264 142.379 74.7069C141.68 75.9786 141.178 77.4307 140.335 78.5195C139.359 79.7786 138.883 81.2348 138.478 82.5594C137.502 85.7463 136.14 88.8174 135.724 92.2093C135.334 95.393 135.165 98.5572 135.173 101.749C135.175 102.558 135.158 103.378 135.828 103.933C136.471 104.465 135.954 105.149 136.191 105.729C136.781 107.171 137.395 108.608 137.871 110.088C138.396 111.72 139.397 113.162 139.649 114.908C139.805 115.99 140.872 116.692 140.946 117.913C141.068 119.92 142.709 121.502 142.706 123.582C142.706 123.726 142.754 123.872 142.797 124.012C143.412 126.03 143.412 125.995 141.178 126.044C139.056 126.09 136.935 125.9 134.81 126.18C133.685 126.327 133.208 125.341 132.925 124.481C132.262 122.464 131.393 120.574 130.063 118.907C129.606 118.334 129.514 117.581 129.232 116.93C128.376 114.959 127.704 112.89 126.101 111.377C124.039 109.431 122.931 106.733 120.816 104.843C119.802 103.936 118.91 102.834 117.52 102.485C116.94 102.339 116.603 101.606 116.544 101.473C116.042 100.337 114.316 100.409 114.195 98.9371C113.546 98.8404 112.654 99.0364 112.616 97.9283C112.612 97.7985 112.34 97.57 112.193 97.57C110.796 97.5696 110.256 95.9113 109.211 95.7917C107.81 95.6313 107.153 94.5211 106.203 93.9338C104.778 93.053 102.856 93.128 101.806 91.6076C101.518 91.1907 101.056 91.667 100.7 91.4951C98.6923 90.5254 96.4567 90.0294 94.4932 89.1674C91.8407 88.0029 88.9463 88.2307 86.3949 86.9542C85.2294 86.3711 84.3079 87.4034 84.7698 88.791C85.3721 90.6003 85.6643 92.4644 86.1005 94.3026C86.4542 95.7928 87.4829 97.1537 87.6778 98.6419C87.8704 100.113 89.0988 101.198 88.9004 102.727C88.8826 102.864 88.9079 103.095 88.9932 103.144C90.7956 104.191 90.4607 106.451 91.6877 107.862C92.3247 108.595 92.6576 109.646 92.9578 110.606C93.4493 112.178 94.6904 113.336 95.6457 114.453C96.329 115.251 96.6109 116.471 97.3818 116.882C99.1624 117.83 99.2834 120.093 101.148 121.035C101.822 121.376 102.872 122.199 103.302 123.331C103.52 123.904 103.992 124.898 105.283 124.622C105.706 124.532 106.843 125.744 106.993 126.268C107.277 127.262 107.951 127.144 108.583 127.325C108.303 128.06 107.753 128.051 107.22 128.121C97.0757 129.45 86.923 130.724 77.0201 133.442C72.6847 134.632 68.4327 136.029 64.5149 138.262C63.332 138.936 62.031 139.597 61.2636 141.077C62.5677 141.396 63.7029 141.286 64.8107 141.241C69.5064 141.049 73.9577 141.944 78.0354 144.298C83.4666 147.433 86.4985 152.106 86.7943 158.459C86.8466 159.583 86.3862 159.908 85.3195 159.892C82.0547 159.844 78.7884 159.849 75.5234 159.889C74.5403 159.902 74.1898 159.608 74.0772 158.566C73.6151 154.29 70.5941 151.588 66.3203 151.242C63.7248 151.031 61.2854 151.247 58.9038 152.403C55.4905 154.061 53.5692 159.438 58.2715 162.631C60.9668 164.461 63.9791 165.503 67.0293 166.493C71.5413 167.956 75.9851 169.527 79.8856 172.372C84.3313 175.615 86.7327 179.823 86.8128 185.391C86.8685 189.257 86.22 192.788 83.6401 195.875C80.9442 199.1 77.4489 200.946 73.4975 201.786C65.5943 203.467 57.8122 203.229 50.5005 199.257C44.6861 196.098 41.5771 191.135 40.8686 184.599C40.7271 183.294 41.114 182.742 42.5518 182.79C45.616 182.892 48.6895 182.907 51.7521 182.783C53.1876 182.724 53.7342 183.319 53.8124 184.581C53.9688 187.106 55.161 189.052 57.0625 190.642C58.4472 191.8 60.1502 192.247 61.8265 192.509C64.0413 192.854 66.3006 192.941 68.5381 192.355C71.7571 191.513 73.7479 189.626 74.0949 186.944C74.4668 184.069 73.0277 181.565 70.0847 179.988C67.5105 178.607 64.7564 177.679 61.996 176.762C57.6358 175.312 53.3614 173.676 49.6168 170.915C45.1761 167.641 42.4444 163.318 42.7268 157.748C42.9603 153.142 43.8839 148.582 46.5384 144.573C47.4297 143.227 48.0159 141.681 48.7592 140.236C49.9778 137.865 52.0582 136.197 53.7465 134.213C55.2752 132.417 57.0437 130.827 58.6321 129.079C59.314 128.328 60.2538 128.05 61.0247 127.461C63.3026 125.721 65.9877 124.623 68.5969 123.566C70.7267 122.702 72.8927 121.674 75.2738 121.454C75.788 121.407 76.3724 121.414 76.9414 120.908C75.6051 120.793 76.4191 119.727 76.0136 119.097C73.0344 114.463 71.1382 109.403 69.8183 104.04C69.0124 100.766 68.7031 97.5113 68.421 94.1869C67.9592 88.7455 68.6545 83.3878 68.9956 77.995C69.0809 76.6454 69.528 75.4165 69.6875 74.1107C69.7793 73.3587 70.2822 73.0612 71.0144 72.9732C73.3567 72.6916 75.7449 72.5767 78.0232 72.02C83.6264 70.6508 89.302 71.193 94.9343 71.2787C98.8133 71.3377 102.65 72.29 106.375 73.5217C107.54 73.9069 108.767 74.1221 109.979 74.3324C110.229 74.3757 110.415 74.2922 110.505 74.6016C110.746 75.4306 111.538 75.5139 112.166 75.6347C113.907 75.9695 115.226 77.0817 116.701 77.906C117.889 78.5697 119.087 79.2018 120.472 79.5873C121.165 77.2486 121.757 75.0479 122.481 72.8912C122.837 71.8306 123.62 70.9696 124.052 69.896C124.74 68.1888 125.635 66.5612 126.255 64.8161C126.394 64.4252 126.665 64.1699 127.049 63.986C127.809 63.621 128.197 63.193 128.398 62.1736C128.539 61.4554 129.012 59.9544 130.383 59.8144C130.687 59.7833 130.862 59.6626 130.95 59.4619C131.69 57.7728 133.658 57.1703 134.486 55.7288C135.594 53.8012 137.556 53.0219 138.99 51.5772C139.336 51.2282 139.698 50.9526 139.886 50.4664C140.082 49.959 140.348 49.468 141.084 49.6534C141.293 49.7061 141.694 49.6268 141.769 49.4835C142.463 48.1584 144.428 48.2624 144.878 46.7114C145.085 45.9968 145.632 46.5916 146.06 46.3581C148.073 45.26 149.912 43.8351 152.114 43.0628C152.956 42.7675 153.524 42.6436 154.403 43.1691C155.454 43.7976 156.469 44.5582 157.755 44.8599C159.013 45.1549 159.993 46.2198 160.93 47.0113C162.531 48.3644 164.336 49.4465 166.037 50.5633C167.364 51.4352 168.425 52.3805 169.465 53.5107C170.112 54.2134 171.355 54.0326 171.971 55.0633C172.293 55.6035 173.063 55.873 172.891 56.7156C172.875 56.7933 172.962 56.9689 173.006 56.9707C174.342 57.0263 174.135 58.5848 174.928 59.0058C176.472 59.8265 177.041 61.3501 178.057 62.558C179.78 64.6082 180.237 67.2543 181.801 69.3405C182.408 70.15 182.581 71.2954 183.409 71.968C184.063 72.4983 183.492 73.154 183.772 73.753C184.536 75.3907 185.108 77.1042 185.415 78.9097C185.543 79.6669 186.028 80.0915 186.919 79.4755C187.807 78.8621 188.709 78.2604 189.651 77.7099C191.986 76.3443 194.433 74.949 196.901 74.2012C199.681 73.359 202.6 72.6589 205.483 72.0114C211.166 70.7349 216.863 71.3105 222.55 71.2449C226.32 71.2015 229.966 72.4761 233.719 72.8027C234.158 72.841 234.595 72.974 235.032 72.967C236.097 72.9501 236.635 73.6074 236.669 74.4993C236.772 77.2077 237.168 79.8887 237.361 82.5886C237.634 86.3924 237.561 90.1881 237.595 93.9878C237.621 96.9524 237.344 99.9353 236.607 102.767C236.049 104.91 235.564 107.11 234.68 109.21C234.045 110.72 233.068 112.27 232.886 113.774C232.622 115.954 230.715 116.839 230.09 118.6C229.959 118.968 229.703 119.289 229.523 119.64C228.977 120.7 229.356 121.42 230.465 121.575C233.91 122.059 237.019 123.494 240.121 124.925C242.848 126.184 245.459 127.699 247.717 129.685C248.586 130.449 249.637 130.79 250.548 131.424C251.167 131.854 251.341 132.483 251.797 132.957C252.308 133.487 252.611 134.15 253.504 134.165C254.069 134.174 254.188 134.731 254.436 135.153C255.11 136.304 255.461 137.806 257.282 137.871C257.101 139.584 258.479 140.376 259.306 141.462C259.84 142.162 260.185 142.787 260.182 143.703C260.153 155.825 260.238 167.948 260.122 180.069C260.077 184.751 259.59 189.416 256.904 193.526C253.617 198.557 248.824 201.355 243.065 202.232C237.083 203.143 231.029 203.181 225.359 200.51C219.393 197.699 215.655 193.069 214.547 186.487C214.014 183.322 213.928 180.121 213.936 176.912C213.961 165.978 213.945 155.043 213.948 144.109C213.949 142.152 213.958 142.147 215.902 142.144C219.504 142.14 223.106 142.143 226.626 142.143C227.063 142.843 226.906 143.452 226.907 144.028C226.917 156.942 226.936 169.856 226.907 182.769C226.895 188.18 230.302 191.935 235.678 192.352C239.166 192.623 242.388 192.171 244.841 189.442C246.837 187.222 247.241 184.438 247.195 181.417Z" fill="#112B53"/>
      <path d="M141.521 143.191C141.513 142.304 141.984 142.153 142.598 142.153C147.446 142.156 152.293 142.159 157.14 142.15C157.843 142.148 158.184 142.471 158.412 143.129C159.138 145.223 159.949 147.286 160.686 149.375C163.337 156.896 165.963 164.426 168.616 171.946C169.926 175.66 171.276 179.359 172.603 183.067C172.687 183.303 172.77 183.525 173.147 183.676C173.959 182.292 174.379 180.729 174.907 179.229C179.047 167.473 183.154 155.704 187.246 143.931C187.68 142.683 188.269 142.058 189.767 142.101C194.116 142.225 198.472 142.173 202.824 142.125C203.96 142.113 204.373 142.45 204.371 143.64C204.34 162.486 204.343 181.331 204.366 200.177C204.368 201.276 204.113 201.782 202.884 201.755C199.621 201.684 196.355 201.697 193.091 201.751C191.969 201.77 191.654 201.332 191.662 200.268C191.7 195.174 191.53 190.073 191.722 184.986C191.901 180.259 192.026 175.523 192.366 170.811C192.565 168.063 192.229 165.284 192.837 162.557C192.971 161.956 192.95 161.277 192.603 160.518C191.541 162.214 191.094 164.063 190.459 165.804C186.33 177.133 182.267 188.486 178.23 199.848C177.738 201.234 177.107 201.935 175.495 201.775C173.682 201.595 171.835 201.668 170.01 201.755C168.921 201.807 168.375 201.348 168.036 200.398C166.039 194.788 164.032 189.182 162.018 183.579C159.506 176.589 156.988 169.601 154.458 162.617C154.282 162.132 153.992 161.689 153.641 161.003C153.068 162.321 153.144 163.451 153.337 164.448C153.867 167.187 153.63 169.958 153.802 172.703C154.379 181.926 154.181 191.173 154.195 200.413C154.197 201.488 153.745 201.757 152.771 201.745C149.754 201.709 146.737 201.735 143.719 201.732C141.512 201.731 141.508 201.728 141.508 199.574C141.507 181.866 141.508 164.158 141.509 146.45C141.509 145.412 141.513 144.373 141.521 143.191Z" fill="#112B53"/>
      <path d="M94.601 164.813C94.6017 157.737 94.6348 150.81 94.5754 143.884C94.5637 142.515 94.9957 142.118 96.3462 142.122C108.617 142.165 120.887 142.165 133.158 142.118C134.53 142.112 134.964 142.538 134.905 143.89C134.809 146.113 134.826 148.344 134.905 150.568C134.949 151.797 134.522 152.184 133.296 152.177C125.33 152.134 117.364 152.155 109.398 152.157C107.28 152.158 107.278 152.162 107.277 154.294C107.275 157.757 107.314 161.221 107.255 164.684C107.236 165.865 107.665 166.219 108.813 166.212C115.492 166.173 122.173 166.238 128.851 166.16C130.37 166.143 130.841 166.605 130.757 168.095C130.64 170.167 130.668 172.252 130.746 174.327C130.793 175.576 130.314 175.93 129.111 175.922C122.531 175.879 115.95 175.902 109.369 175.905C107.282 175.906 107.278 175.908 107.277 177.922C107.274 182.029 107.338 186.137 107.243 190.242C107.209 191.719 107.724 192.058 109.113 192.048C117.078 191.99 125.045 192.059 133.01 191.986C134.53 191.972 134.994 192.422 134.91 193.915C134.792 196.036 134.84 198.17 134.9 200.295C134.932 201.387 134.544 201.753 133.446 201.751C121.027 201.722 108.608 201.713 96.1892 201.761C94.7912 201.767 94.5792 201.189 94.5825 199.991C94.6144 188.314 94.6013 176.638 94.601 164.813Z" fill="#112B53"/>
      <path d="M154.496 99.0245C154.862 101.917 155.85 104.551 156.336 107.315C156.979 110.974 157.713 114.62 157.905 118.322C158.013 120.388 158.848 122.33 158.66 124.431C158.577 125.351 158.341 125.763 157.363 125.748C154.693 125.707 152.021 125.713 149.35 125.746C148.419 125.758 148.055 125.438 148.021 124.465C147.893 120.853 148.132 117.227 148.764 113.719C149.249 111.03 149.419 108.265 150.17 105.646C151.165 102.177 151.271 98.4995 152.935 95.0137C154.013 96.0744 153.954 97.6275 154.496 99.0245Z" fill="#112B53"/>
      <path d="M97.5673 98.1901C98.3951 97.8317 98.8713 98.361 99.425 98.6364C99.3675 99.3278 99.2798 100.003 99.2617 100.679C99.2229 102.129 98.2981 102.79 97.0606 103.052C95.6741 103.345 94.7232 102.34 94.2735 101.366C93.8232 100.391 94.096 99.143 95.0524 98.288C95.8282 97.5946 96.6519 98.1974 97.5673 98.1901Z" fill="#112B53"/>
      <path d="M211.953 95.9463C213.716 97.232 213.029 98.8006 212.751 100.339C211.956 100.399 211.24 100.449 210.524 100.507C209.052 100.627 208.127 99.7386 208.006 98.0834C207.916 96.8419 208.834 95.8977 210.227 95.8421C210.766 95.8206 211.309 95.8763 211.953 95.9463Z" fill="#112B53"/>
      <path d="M150.865 76.4373C150.785 75.9321 150.681 75.5331 150.726 75.1512C150.815 74.3838 150.016 73.3341 151.39 72.9449C152.777 72.5523 154.134 72.4513 154.999 73.8591C155.586 74.8137 155.04 76.3637 154.011 77.0254C152.853 77.7698 151.794 77.6818 150.865 76.4373Z" fill="#112B53"/>
    </svg>
    <h1 [@flyUpAndAwayFar]="animState" *ngIf="this.messages.length === 0" class="background-image-text">Hei! Kuidas saan sind täna aidata?</h1>
    <div class="chat-message-container" [class.image]="message.isImage" [class.assistant]="!message.isUser" *ngFor="let message of messages">
      <div *ngIf="message.isUser && !isMobile && !message.isImage" class="user-icon">
        <svg width="75" height="75" viewBox="0 0 75 75" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="37.5" cy="37.5" r="37.5" fill="#D9D9D9"/>
          <path d="M18.46 48V27.18H21.28V48H18.46ZM31.9 48V27.18H34.72V48H31.9ZM20.38 38.52V35.94H32.59V38.52H20.38ZM52.5116 48L42.0116 37.14L52.3016 27.18H55.9616L44.8616 37.86V36.3L56.2616 48H52.5116ZM39.6416 48V27.18H42.4616V48H39.6416Z" fill="black"/>
        </svg>
      </div>
      <img class="user-image" *ngIf="message.isImage" [src]="'data:image/jpg;base64,' + message.content" alt="Sent image">
      <app-typewriter *ngIf="message.isTypeable && !message.isImage" [fast]="message.fast ?? false" (typingFinished)="onTypingFinished()" [startTyping]="messageIndex === message.id && !message.hasStartedTyping" class="chat-message" [class.left]="!message.isUser" [message]="message"></app-typewriter>
      <div [class.left]="!message.isUser"
           class="chat-message"
           *ngIf="!message.isTypeable && !message.isImage"
           [mathjax]="(isMobile ? (message.isUser ? userLabel : assistantLabel) : '') + message.content">
      </div>
      <div *ngIf="!message.isUser && !isMobile" class="assistant-icon">
        <img src="assets/semu-hea.png" alt="Logo">
      </div>
      <div id="bottom-anchor" #bottomAnchor *ngIf="messages.indexOf(message) === messages.length + 1"></div>
    </div>
    <div class="chat-message-container" *ngIf="userIsTyping">
      <div class="user-icon">
        <svg width="75" height="75" viewBox="0 0 75 75" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="37.5" cy="37.5" r="37.5" fill="#D9D9D9"/>
          <path d="M18.46 48V27.18H21.28V48H18.46ZM31.9 48V27.18H34.72V48H31.9ZM20.38 38.52V35.94H32.59V38.52H20.38ZM52.5116 48L42.0116 37.14L52.3016 27.18H55.9616L44.8616 37.86V36.3L56.2616 48H52.5116ZM39.6416 48V27.18H42.4616V48H39.6416Z" fill="black"/>
        </svg>
      </div>
      <div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>
    </div>
    <div #typingNotification class="chat-message-container assistant" *ngIf="isTyping">
      <div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>
      <div class="assistant-icon">
        <img src="assets/semu-hea.png" alt="Logo">
      </div>
    </div>
  </div>
  <div class="rate-limit-warning" *ngIf="_rateLimited">
    <div>
      <img src="assets/icons/warning.svg">
      <p>SEMU sõnumite limiit ületatud</p>
    </div>
    <h1>{{countdown}}</h1>
  </div>
  <div [@inputFlyDown]="inputboxAnimState" [class.keyboard-open]="keyboardFocused" class="input-container">
    <svg (click)="createNewConversation()" width="33" height="33" viewBox="0 0 33 33" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M12.375 16.5H20.625" stroke="#CED7E0" stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M16.5 12.375V20.625" stroke="#CED7E0" stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M4.125 16.5C4.125 6.30919 6.30919 4.125 16.5 4.125C26.6908 4.125 28.875 6.30919 28.875 16.5C28.875 26.6908 26.6908 28.875 16.5 28.875C6.30919 28.875 4.125 26.6908 4.125 16.5Z" stroke="#CED7E0" stroke-width="3.5"/>
    </svg>
    <svg (click)="triggerFileInput()" width="35" height="35" viewBox="0 0 35 35" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M12.396 14.5835C13.6041 14.5835 14.5835 13.6041 14.5835 12.396C14.5835 11.1879 13.6041 10.2085 12.396 10.2085C11.1879 10.2085 10.2085 11.1879 10.2085 12.396C10.2085 13.6041 11.1879 14.5835 12.396 14.5835Z" fill="#CED7E0"/>
      <path fill-rule="evenodd" clip-rule="evenodd" d="M15.5242 2.9165H18.3088C20.2492 2.91649 21.7924 2.91649 23.0367 3.01982C24.3111 3.12565 25.397 3.34707 26.3886 3.86223C27.9228 4.65918 29.1737 5.91012 29.9708 7.44431C30.486 8.43605 30.7073 9.52186 30.8131 10.7962C30.9165 12.0406 30.9165 13.5837 30.9165 15.5241V18.3088C30.9165 19.2761 30.9165 20.1449 30.9037 20.9269C30.9233 21.0713 30.9204 21.2181 30.8949 21.3615C30.8802 21.9739 30.8553 22.5301 30.8131 23.0367C30.7073 24.3112 30.486 25.397 29.9708 26.3886C29.1737 27.9229 27.9228 29.1738 26.3886 29.9708C25.397 30.486 24.3111 30.7073 23.0367 30.8132C21.7924 30.9165 20.2492 30.9165 18.3089 30.9165H15.5242C13.5839 30.9165 12.0406 30.9165 10.7962 30.8132C9.52185 30.7073 8.43604 30.486 7.44431 29.9708C6.33076 29.3923 5.36644 28.5747 4.61662 27.5832C4.60242 27.5652 4.58872 27.547 4.5755 27.5284C4.30887 27.1698 4.07012 26.7889 3.86223 26.3886C3.34707 25.397 3.12565 24.3112 3.01982 23.0367C2.91649 21.7924 2.91649 20.2492 2.9165 18.3088V15.5242C2.91649 13.5838 2.91649 12.0406 3.01982 10.7962C3.12565 9.52186 3.34707 8.43605 3.86223 7.44431C4.65918 5.91012 5.91012 4.65918 7.44431 3.86223C8.43604 3.34707 9.52185 3.12565 10.7962 3.01982C12.0406 2.91649 13.5838 2.91649 15.5242 2.9165ZM28.1165 15.5865V17.633L26.1747 15.6075C25.0684 14.4535 23.2221 14.4584 22.122 15.6183L15.5882 22.5066L13.438 19.9068C12.2871 18.5152 10.1392 18.5609 9.04861 20.0004L5.98309 24.0464C5.90805 23.7013 5.85098 23.296 5.81022 22.805C5.71762 21.6901 5.7165 20.2632 5.7165 18.2465V15.5865C5.7165 13.5698 5.71762 12.1429 5.81022 11.028C5.90141 9.92987 6.07403 9.26049 6.34699 8.73504C6.87829 7.71225 7.71224 6.87829 8.73503 6.34699C9.26048 6.07404 9.92986 5.90142 11.028 5.81022C12.1428 5.71762 13.5698 5.7165 15.5865 5.7165H18.2465C20.2632 5.7165 21.6901 5.71762 22.805 5.81022C23.9032 5.90142 24.5725 6.07404 25.0979 6.34699C26.1208 6.87829 26.9547 7.71225 27.486 8.73504C27.7589 9.26049 27.9315 9.92987 28.0228 11.028C28.1153 12.1429 28.1165 13.5698 28.1165 15.5865ZM8.73503 27.4861C8.29527 27.2576 7.8904 26.9731 7.5295 26.6419L11.2804 21.6913L13.4306 24.2911C14.5013 25.5859 16.4634 25.6525 17.6197 24.4335L24.1535 17.5451L28.0859 21.6474C28.0721 22.0702 28.0519 22.4531 28.0228 22.805C27.9315 23.9032 27.7589 24.5725 27.486 25.098C26.9547 26.1208 26.1208 26.9548 25.0979 27.4861C24.5725 27.7589 23.9032 27.9316 22.805 28.0228C21.6901 28.1154 20.2632 28.1165 18.2465 28.1165H15.5865C13.5698 28.1165 12.1428 28.1154 11.028 28.0228C9.92986 27.9316 9.26048 27.7589 8.73503 27.4861Z" fill="#CED7E0"/>
    </svg>
    <svg (click)="toggleRecording()" width="25" height="28" viewBox="0 0 25 28" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M23 14V15.3333C23 21.2244 18.299 26 12.5 26C6.70101 26 2 21.2244 2 15.3333V14M12.5 20.6667C9.6005 20.6667 7.25 18.2788 7.25 15.3333V7.33333C7.25 4.38781 9.6005 2 12.5 2C15.3994 2 17.75 4.38781 17.75 7.33333V15.3333C17.75 18.2788 15.3994 20.6667 12.5 20.6667Z"
            [attr.stroke]="isRecording ? 'red' : '#CED7E0'" stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    <input type="file" #fileInput (change)="onFileSelected($event)" accept="image/*" style="display:none;">
    <textarea (focusin)="onKeyboardFocus()" (focusout)="onKeyboardFocusOut()" class="textbox" #input (keyup.enter)="onSendMessage(input.value, input)" placeholder="Sisesta sõnum..."></textarea>
    <svg (click)="onSendMessage(input.value, input)" width="42" height="42" viewBox="0 0 42 42" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M18.3692 21.004H9.68428M9.43811 22.2456L8.00324 26.92C7.21738 29.4802 6.82445 30.7602 7.10643 31.5484C7.3513 32.2331 7.87724 32.752 8.52623 32.9496C9.27355 33.177 10.4023 32.6231 12.6598 31.5153L27.1324 24.4126C29.3359 23.3311 30.4376 22.7905 30.7781 22.0393C31.074 21.3868 31.074 20.621 30.7781 19.9684C30.4376 19.2174 29.3359 18.6767 27.1324 17.5953L12.6348 10.4804C10.3841 9.37587 9.2588 8.82359 8.51222 9.05015C7.86385 9.2469 7.33796 9.76451 7.09224 10.4478C6.80928 11.2346 7.19801 12.5119 7.9755 15.0665L9.44089 19.8815C9.57442 20.3202 9.64119 20.5397 9.66754 20.764C9.69093 20.9632 9.69069 21.1647 9.66684 21.3637C9.63995 21.588 9.57267 21.8071 9.43811 22.2456Z" stroke="#CED7E0" stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </div>
</div>
